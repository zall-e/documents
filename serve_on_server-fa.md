# راهنمای راه‌اندازی پروژه بر روی سرور با استفاده از Nginx

این راهنما مراحل لازم برای اجرای پروژه روی سرور با استفاده از Nginx را به شما نشان می‌دهد. در این راهنما، نحوه‌ی باز کردن پورت، نصب Nginx، پیکربندی فایل‌های تنظیمات و بررسی صحت پیکربندی آورده شده است.

---

## فهرست مطالب

- [۱. باز کردن پورت](#۱-باز-کردن-پورت)
- [۲. نصب Nginx](#۲-نصب-nginx)
- [۳. پیکربندی Nginx](#۳-پیکربندی-nginx)
  - [الف. ایجاد فایل تنظیمات](#الف-ایجاد-فایل-تنظیمات)
  - [ب. فعال‌سازی پیکربندی](#ب-فعال‌سازی-پیکربندی)
- [۴. بررسی و راه‌اندازی مجدد Nginx](#۴-بررسی-و-راه‌اندازی-مجدد-nginx)
- [۵. نکات تکمیلی](#۵-نکات-تکمیلی)

---

## ۱. باز کردن پورت

ابتدا باید پورت مورد نظر (مثلاً **8080**) را از طریق فایروال باز کنید. در صورت استفاده از پورت متفاوت، مقدار آن را تغییر دهید.

```bash
sudo ufw allow 8080
```

*نکته:* بررسی وضعیت فایروال با دستور زیر می‌تواند مفید باشد:
```bash
sudo ufw status
```

---

## ۲. نصب Nginx

اگر Nginx قبلاً نصب نشده است، می‌توانید آن را با دستورات زیر نصب کنید:

```bash
sudo apt update
sudo apt install nginx
```

---

## ۳. پیکربندی Nginx

### الف. ایجاد فایل تنظیمات

1. به دایرکتوری تنظیمات Nginx بروید:
   ```bash
   cd /etc/nginx/sites-available/
   ```

2. یک فایل تنظیمات جدید ایجاد کنید. به عنوان مثال، فایل را `your_project` بنامید (می‌توانید نام دلخواهی انتخاب کنید):
   ```bash
   sudo nano your_project
   ```

3. در داخل فایل، پیکربندی سرور را وارد کنید. مثال زیر یک پیکربندی اولیه است که از پورت **8080** استفاده می‌کند و درخواست‌ها را به یک برنامه که روی پورت **3000** در حال اجراست هدایت می‌کند:

   ```nginx
   server {
       listen 8080;
       server_name your_domain_or_IP;  # به جای this, دامنه یا آدرس IP سرور خود را قرار دهید

       location / {
           proxy_pass http://localhost:3000;  # پورت برنامه خود را در صورت نیاز تغییر دهید
           proxy_http_version 1.1;
           proxy_set_header Upgrade $http_upgrade;
           proxy_set_header Connection 'upgrade';
           proxy_set_header Host $host;
           proxy_cache_bypass $http_upgrade;
       }
   }
   ```

4. فایل را ذخیره و ویرایشگر را ببندید. در **nano** این کار با کلیدهای `Ctrl+O` برای ذخیره و `Ctrl+X` برای خروج انجام می‌شود.

### ب. فعال‌سازی پیکربندی

فایل تنظیمات ایجاد شده را از دایرکتوری `sites-available` به `sites-enabled` لینک کنید:

```bash
sudo ln -s /etc/nginx/sites-available/your_project /etc/nginx/sites-enabled/
```

*نکته:* در صورتی که فایل مشابهی در `sites-enabled` موجود باشد، قبل از ایجاد لینک باید آن را حذف کنید یا نام فایل را تغییر دهید.

---

## ۴. بررسی و راه‌اندازی مجدد Nginx

### الف. بررسی صحت پیکربندی

قبل از اعمال تغییرات، از صحت فایل‌های تنظیمات اطمینان حاصل کنید:

```bash
sudo nginx -t
```

در صورت مشاهده پیغام موفقیت، می‌توانید ادامه دهید.

### ب. بارگذاری مجدد پیکربندی

پس از اطمینان از درستی تنظیمات، Nginx را مجدداً بارگذاری کنید:

```bash
sudo systemctl reload nginx
```

در صورت بروز مشکل یا نیاز به راه‌اندازی مجدد کامل، از دستور زیر استفاده کنید:

```bash
sudo systemctl restart nginx
```

---

## ۵. نکات تکمیلی

- **امنیت:**  
  - مطمئن شوید که تنظیمات فایروال و دسترسی‌های سرور به درستی پیکربندی شده‌اند.
  - در صورت استفاده از دامنه، توصیه می‌شود برای امنیت ارتباط از HTTPS استفاده کنید.  
- **پیکربندی پیشرفته:**  
  - برای استفاده از SSL می‌توانید از **Certbot** استفاده کرده و گواهی‌های رایگان دریافت کنید.
  - تنظیمات کش (cache) و بهینه‌سازی‌های بیشتر را بر اساس نیاز پروژه خود اعمال کنید.
- **لاگ‌ها:**  
  - برای رفع اشکال، لاگ‌های Nginx را می‌توانید در مسیر `/var/log/nginx/` مشاهده کنید.

---

## نتیجه‌گیری

با انجام مراحل فوق، پروژه شما بر روی سرور با استفاده از Nginx قابل دسترسی خواهد بود. در صورت نیاز به تغییرات، فایل‌های تنظیمات را ویرایش و دوباره Nginx را راه‌اندازی مجدد کنید. این راهنما می‌تواند به عنوان یک نقطه شروع برای پیکربندی‌های پیشرفته‌تر نیز مورد استفاده قرار گیرد.
